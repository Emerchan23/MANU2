const mysql = require('mysql2/promise');
require('dotenv').config();

async function forceFix() {
    let connection;
    
    try {
        console.log('üîß For√ßando corre√ß√£o dos tipos de manuten√ß√£o...');
        
        connection = await mysql.createConnection({
            host: process.env.DB_HOST || 'localhost',
            user: process.env.DB_USER || 'root',
            password: process.env.DB_PASSWORD || '',
            database: process.env.DB_NAME || 'hospital_maintenance'
        });

        // Limpar completamente a tabela
        console.log('üóëÔ∏è Limpando tabela tipos_manutencao...');
        await connection.execute('TRUNCATE TABLE tipos_manutencao');
        
        // Inserir dados corretos
        console.log('üìù Inserindo dados corretos...');
        await connection.execute(`
            INSERT INTO tipos_manutencao (nome, descricao, categoria) VALUES 
            ('Preventiva', 'Manuten√ß√£o preventiva programada', 'preventiva'),
            ('Corretiva', 'Manuten√ß√£o corretiva para reparo', 'corretiva'),
            ('Preditiva', 'Manuten√ß√£o baseada em condi√ß√£o', 'preditiva'),
            ('Calibra√ß√£o', 'Calibra√ß√£o de equipamentos', 'calibracao'),
            ('Instala√ß√£o', 'Instala√ß√£o de novos equipamentos', 'instalacao'),
            ('Desinstala√ß√£o', 'Remo√ß√£o de equipamentos', 'desinstalacao'),
            ('Consultoria', 'Servi√ßos de consultoria t√©cnica', 'consultoria')
        `);
        
        console.log('‚úÖ Dados corretos inseridos!');

        // Verificar dados inseridos
        const [data] = await connection.execute('SELECT * FROM tipos_manutencao WHERE ativo = 1 ORDER BY nome');
        
        console.log(`\nüìä Total de registros ativos: ${data.length}`);
        console.log('\nüìã Dados inseridos:');
        data.forEach(row => {
            console.log(`  - ID: ${row.id}, Nome: ${row.nome}, Categoria: ${row.categoria}, Descri√ß√£o: ${row.descricao}`);
        });

    } catch (error) {
        console.error('‚ùå Erro ao corrigir tipos_manutencao:', error.message);
    } finally {
        if (connection) {
            await connection.end();
        }
    }
}

forceFix();